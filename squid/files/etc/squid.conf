workers 4
# auth_param negotiate program <uncomment and complete this line to activate>
# auth_param negotiate children 20 startup=0 idle=1
# auth_param negotiate keep_alive on
# external_acl_type name [options] FORMAT.. /path/to/helper [helper arguments..]
ttl=3600
negative_ttl=3600
grace=5 # percent remaining before refreshing the ttl
cache=262144.
children-max=20
children-startup=2
children-idle=2

# acl always_allow_src_ip src 192.168.0.0-192.168.0.254/24
#	acl aclname src ip-address/mask ...	# clients IP address [fast]
#	acl aclname src addr1-addr2/mask ...	# range of addresses [fast]
#	acl aclname dst [-n] ip-address/mask ...	# URL host's IP address [slow]
#	acl aclname localip ip-address/mask ... # IP address the client connected to [fast]
#	acl aclname arp      mac-address ... (xx:xx:xx:xx:xx:xx notation)
#	acl aclname dstdom_regex [-n] [-i] \.foo\.com ...
#	acl aclname url_regex [-i] ^http:// ...
acl proxy_auth proxy_auth REQUIRED
# acl aclname proxy_auth_regex [-i] pattern ...
#	acl aclname maxconn number
#	acl aclname max_user_ip [-s] number
#	acl aclname random probability
#	acl aclname req_mime_type [-i] mime-type ...
#	acl aclname req_header header-name [-i] any\.regex\.here
#	acl aclname rep_mime_type [-i] mime-type ...
#	acl aclname rep_header header-name [-i] any\.regex\.here
#	acl aclname external class_name [arguments...]
#	acl aclname user_cert attribute values...
#	acl aclname ca_cert attribute values...
#	acl aclname ext_user username ...
#	acl aclname ext_user_regex [-i] pattern ...
#	acl aclname tag tagvalue ...
#	acl aclname hier_code codename ...
#	acl aclname note name [value ...]
#	acl aclname adaptation_service service ...
#	acl aclname any-of acl1 acl2 ...
#	acl aclname all-of acl1 acl2 ... 
# ACLs all, manager, localhost, and to_localhost are predefined.
acl localnet src 10.0.0.0/8	# RFC1918 possible internal network
acl localnet src 172.16.0.0/12	# RFC1918 possible internal network
acl localnet src 192.168.0.0/16	# RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines
acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT
# Deny requests to certain unsafe ports
http_access deny !Safe_ports
# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports
# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager
http_access deny to_localhost
http_access allow localnet
http_access allow localhost
# And finally deny all other access to this proxy
http_access deny all
#		reply_body_max_size 10 MB
0.0.0.0:SQUID_PROXY_PORT intercept act-as-origin
# 0.0.0.0:SQUID_PROXY accel
# 0.0.0.0:SQUID_PROXY ssl-bump generate-host-certificates=on cert=cert.pem key=key.pem version=6 cipher=HIGH options=NO_SSLv2,NO_SSLv3,NO_TLSv1,NOTLSv1_1,SINGLE_DH_USE clientca=clientca.txt cafile=cafile.txt capath=/etc/pki/tls/catrusts crlfile=revokefile.txt dhparams=dhparams.txt sslflags=VERIFY_CRL connection-auth=off tcpkeepalive=30,30,5
http_port SQUID_PROXY_PORT
ftp_port SQUID_PROXY_PORT intercept ftp-track-dirs
#tcp_outgoing_tos 0x20 localnet
#tcp_outgoing_tos 0x10 noprio
#tcp_outgoing_mark 0x20 localnet
#host_verify_strict on
#client_dst_passthru on
# ssl_bump bump all
cache_peer multicast sibling SQUID_PROXY_PORT SQUID_ICP_PORT multicast_responder background-ping multicast-siblings connection-auth=off ssl sslcert=/etc/ssl/certs/ssl-cert-snakeoil.pem sslkey=/etc/ssl/private/ssl-cert-snakeoil.key sslversion=6 sslcipher=HIGH ssloptions=NO_SSLv2,NO_SSLv3,NO_TLSv1,NOTLSv1_1,    SINGLE_DH_USE sslcrlfile=revokefile.txt connect-timeout=5 connect-fail-limit=2 standby=1 name=SQUID_PEER_NAME
cache_peer_access SQUID_PEER_NAME allow localnet
dead_peer_timeout 10 seconds forward_max_tries 25
maximum_object_size_in_memory 5120 KB
memory_cache_shared	on # max 32KB objects
memory_cache_mode always
memory_replacement_policy lru
cache_replacement_policy heap LFUDA
minimum_object_size	0 KB
maximum_object_size	32 MB
cache_dir aufs /var/spool/squid 1024 100 16
# store_dir_select_algorithm least-load # in case of multiple harddrives
cache_swap_low 90 # percent
cache_swap_high 95 # percent
logformat custom_with_total_time   %>a %[ui %[un [%tl] "%rm %ru HTTP/%rv" %>Hs %<st "%{Referer}>h" "%{User-Agent}>h" %Ss:%Sh [http::]<tt
#access_log daemon logformat=custom_with_total_time on-error=die
access_log tcp:tcp//SQUID_EXTERNAL_LOGSERVER_IP:SQUID_EXTERNAL_LOGSERVER_PORT logformat=custom_with_totaltime on-error=die
# logfile_daemon /usr/lib/squid/log_file_daemon
stats_collection allow localnet
# cache swap_state /var/spool/squid/cache_swap/
logfile_rotate 10
# mime_table /usr/share/squid/mime.conf
# log_mime_hdrs off
pid_filename /var/run/squid.pid
# client_netmask 255.255.255.0 # anonymize last octet on client
strip_query_terms on
buffered_logs	on
netdb_filename stdio:/var/log/squid/netdb.state
cache_log /var/log/squid/cache.log
debug_options ALL,1 # increase the digit for more verbosity
coredump_dir /var/spool/squid
# ftp_user anonymous
# ftp_passive on
# ftp_epsv_all off
# ftp_epsv allow|deny al1 acl2 ...
# ftp_eprt on
# ftp_sanitycheck on
# ftp_telnet_protocol on
# diskd_program /usr/lib/squid/diskd
# unlinkd_program /usr/lib/squid/unlinkd
# pinger_program /usr/lib/squid/pinger
# pinger_enable on
# store_id_extras "%>a/%>A %un %>rm myip=%la myport=%lp"
# store_id_children 20 startup=4 idle=8 concurrency=2
# store_id_bypass on
cache
max_stale 1 week
#refresh_pattern -i *.? 0 95 1 week # refresh everything before timeout and throw out stale items refresh-ims
#
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern (Release|Packages(.gz)*)$      0       20%     2880
# example lin deb packages
#refresh_pattern (\.deb|\.udeb)$   129600 100% 129600
refresh_pattern .		0	20%	4320
# quick_abort_min 16 KB
# quick_abort_max 16 KB
# read_ahead_gap 16 KB
# negative_ttl 0 seconds
# positive_dns_ttl 6 hours
# negative_dns_ttl 1 minutes
# minimum_expiry_time 60 seconds
# store_avg_object_size 13 KB
# store_objects_per_bucket 20
# request_header_max_size 64 KB
# reply_header_max_size 64 KB
# request_body_max_size	10 GB
# client_request_buffer_max_size 512 KB
# adaptation_uses_indirect_client on
# via on
# ie_refresh off
# vary_ignore_expire off
# request_entities off
#		request_header_access From deny all
#		request_header_access Referer deny all
#		request_header_access User-Agent deny all
#		request_header_access Authorization allow all
#		request_header_access Proxy-Authorization allow all
#		request_header_access Cache-Control allow all
#		request_header_access Content-Length allow all
#		request_header_access Content-Type allow all
#		request_header_access Date allow all
#		request_header_access Host allow all
#		request_header_access If-Modified-Since allow all
#		request_header_access Pragma allow all
#		request_header_access Accept allow all
#		request_header_access Accept-Charset allow all
#		request_header_access Accept-Encoding allow all
#		request_header_access Accept-Language allow all
#		request_header_access Connection allow all
#		request_header_access All deny all
#		reply_header_access Allow allow all
#		reply_header_access WWW-Authenticate allow all
#		reply_header_access Proxy-Authenticate allow all
#		reply_header_access Cache-Control allow all
#		reply_header_access Content-Encoding allow all
#		reply_header_access Content-Length allow all
#		reply_header_access Content-Type allow all
#		reply_header_access Date allow all
#		reply_header_access Expires allow all
#		reply_header_access Last-Modified allow all
#		reply_header_access Location allow all
#		reply_header_access Pragma allow all
#		reply_header_access Content-Language allow all
#		reply_header_access Retry-After allow all
#		reply_header_access Title allow all
#		reply_header_access Content-Disposition allow all
#		reply_header_access Connection allow all
#		reply_header_access All deny all
# reply_header_replace Server Foo/1.0
# request_header_add X-Client-CA "CA=%ssl::>cert_issuer" all
#	    note key value acl ...
##	    logformat myFormat ... %{key}note ...
# relaxed_header_parser on
# collapsed_forwarding off
# forward_timeout 4 minutes
# connect_timeout 1 minute
peer_connect_timeout 30 seconds
read_timeout 15 minutes
# write_timeout 15 minutes
# request_timeout 5 minutes
# client_idle_pconn_timeout 2 minutes
# ftp_client_idle_timeout 30 minutes
# client_lifetime 1 day
# half_closed_clients off
# server_idle_pconn_timeout 1 minute
# ident_timeout 10 seconds
# shutdown_lifetime 30 seconds
cache_mgr SQUID_EMAIL_ADMIN
mail_from SQUID_EMAIL_FROMADDRESS
mail_program mail
cache_effective_user SQUID_EFFECTIVE_USER # drop user privs
cache_effective_group SQUID_EFFECTIVE_USER # drop group privs
httpd_suppress_version_string off # we want to know if the squid is foul
# visible_hostname
# unique_hostname
# hostname_aliases
umask 027
#	announce_period 1 day # do we want to show people what we surf on
# announce_host tracker.ircache.net # to where
# announce_file and_this_file_will_be_sent_too
# announce_port 3131
# http_accel_surrogate_remote off
# esi_parser custom
# delay_pools 0
#	delay_access 1 allow some_big_clients
#		delay_class pool 1
#		delay_parameters pool aggregate
#		delay_parameters 1 none 8000/8000
#		delay_parameters 2 32000/32000 8000/8000 600/8000
# delay_initial_bucket_level 50
# client_delay_pools 0
#		client_delay_initial_bucket_level 50
#		client_delay_parameters 1 1024 2048
#		client_delay_parameters 2 51200 16384
#		client_delay_access 1 allow low_rate_network
#		client_delay_access 2 allow vips_network
# client_persistent_connections on
# server_persistent_connections on
# persistent_connection_after_error on
detect_broken_pconn on
digest_generation on
# digest_bits_per_entry 5
# digest_rebuild_period 1 hour
# digest_rewrite_period 1 hour
# digest_swapout_chunk_size 4096 bytes
# digest_rebuild_chunk_percentage 10
#		snmp_port 3401
# 	snmp_access allow snmppublic snmpclients
#    snmp_access deny all
icp_port SQUID_ICP_PORT # 3130 default
log_icp_queries on
icp_hit_stale on
# minimum_direct_hops 4
# minimum_direct_rtt 400
# netdb_low 900
# netdb_high 1000
# netdb_ping_period 5 minutes
query_icmp on
# test_reachability off
# icp_query_timeout 2000
# maximum_icp_query_timeout 2000
# minimum_icp_query_timeout 5
background_ping_rate 10 seconds
mcast_groups 239.128.16.128 224.0.1.20
# mcast_miss_addr
# mcast_miss_ttl 16
# mcast_miss_port SQUID_MCAST_MISS_PORT
# mcast_miss_encode_key SQUID_MCAST_MISS_CRYPTKEY
# mcast_icp_query_timeout 2000
# icon_directory /usr/share/squid/icons
global_internal_static on
# short_icon_urls on
# error_default_language
# error_log_languages on
# err_page_stylesheet /etc/squid/errorpage.css
err_html_text SQUID_ERROR_TEXT>
# email_err_data on
# deny_info ERR_CUSTOM_ACCESS_DENIED bad_guys
# nonhierarchical_direct on
# prefer_direct off
# cache_miss_revalidate on
#		acl local-servers dstdomain my.domain.net
#		always_direct allow local-servers
#		acl FTP proto FTP
#		always_direct allow FTP
#		acl local-external dstdomain external.foo.net
#		acl local-servers dstdomain  .foo.net
#		always_direct deny local-external
#		always_direct allow local-servers
#		acl local-servers dstdomain .foo.net
#		never_direct deny local-servers
#		never_direct allow all
#		acl local-intranet dstdomain .foo.net
#		acl local-external dstdomain external.foo.net
#		always_direct deny local-external
#		always_direct allow local-intranet
#		never_direct allow all
# incoming_udp_average 6
# incoming_tcp_average 4
# incoming_dns_average 4
# min_udp_poll_cnt 8
# min_dns_poll_cnt 8
# min_tcp_poll_cnt 8
## FreeBSD
#accept_filter httpready
## Linux
#accept_filter data
# client_ip_max_connections 100
# tcp_recv_bufsize	(bytes)
# icap_enable off
# icap_connect_timeout
# icap_io_timeout	time-units
#	icap_service_failure_limit 10 in 5 seconds
# icap_service_revival_delay 180
# icap_preview_enable on
# icap_preview_size
# icap_206_enable on
# icap_default_options_ttl 60
# icap_persistent_connections on
# adaptation_send_client_ip off
# adaptation_send_username off
# icap_client_username_header X-Client-Username
# icap_client_username_encode off
#icap_service svcBlocker reqmod_precache icap://icap1.mydomain.net:1344/reqmod bypass=0
#icap_service svcLogger reqmod_precache icap://icap2.mydomain.net:1344/respmod routing=on
# ecap_enable off
#ecap_service s1 reqmod_precache ecap://filters.R.us/leakDetector?on_error=block bypass=off
#ecap_service s2 respmod_precache ecap://filters.R.us/virusFilter config=/etc/vf.cfg bypass=on
#loadable_modules /usr/lib/MinimalAdapter.so
#adaptation_service_set svcBlocker urlFilterPrimary urlFilterBackup
#adaptation service_set svcLogger loggerLocal loggerRemote
#adaptation_service_chain svcRequest requestLogger urlFilter leakDetector
#adaptation_access service_1 allow all
# adaptation_service_iteration_limit 16
#adaptation_masterx_shared_names X-Subscriber-ID
#		adaptation_meta X-Debug 1 needs_debugging
#		adaptation_meta X-Log 1 !keep_secret
#		adaptation_meta X-Authenticated-Groups "G 1" authed_as_G1
# icap_retry deny all
# check_hostnames off
# allow_underscore on
# dns_retransmit_interval 5 seconds
# dns_timeout 30 seconds
# dns_packet_max 1500 # bytes
# dns_defnames	off
# dns_multicast_local off
# dns_nameservers 10.0.0.1 192.172.0.4
# hosts_file /etc/hosts
# append_domain .yourdomain.com
# ignore_unknown_nameservers on
# dns_v4_first off
# ipcache_size 1024
# ipcache_low 90
# ipcache_high 95
# fqdncache_size 1024
# configuration_includes_quoted_values off
# memory_pools on
#	memory_pools_limit 50 MB
forwarded_for off
# cachemgr_passwd secret shutdown
# cachemgr_passwd lesssssssecret info stats/objects
# cachemgr_passwd disable all
# client_db on
# refresh_all_ims off
# reload_into_ims off
# connect_retries
# retry_on_error off
# as_whois_server whois.ra.net
# offline_mode off
# uri_whitespace strip
# chroot
# balance_on_multiple_ip off
pipeline_prefetch 10
# high_response_time_warning	(msec)
#  high_page_fault_warning
# high_memory_warning
# sleep_after_fork 0
# windows_ipaddrchangemonitor on
# eui_lookup on
# max_filedescriptors

